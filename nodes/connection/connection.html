<script type="text/html" data-template-name="eip-io connection">
    <style>
        .red-ui-editor .form-row label {
            width: 125px;
        }

        #node-config-input-configdata-row .red-ui-editableList-header {
            display: flex;
            background: var(--red-ui-tertiary-background);
            padding-right:75px;
            border-top-left-radius: 3px;
            border-top-left-radius: 3px;
        }
        
    </style>

    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>

    <div class="form-row">
        <label for="node-config-input-scanner"><i class="fa fa-tag"></i> Scanner</label>
        <input type="text" id="node-config-input-scanner" placeholder="Scanner">
    </div>

    <div class="form-row conn-tabs-row">
        <ul style="min-width: 500px; margin-bottom: 20px;" id="conn-tabs"></ul>
    </div>

    <div id="conn-tabs-content" style="min-height: calc(100% - 95px)">
        
        <div id="conn-tab-setup" style="display:none">
            <div class="form-row">
                <label for="node-input-ipaddress"><i class="fa fa-tag"></i> IP Address</label>
                <input type="text" id="node-config-input-ipaddress" style="width: 120px;">
            </div>

            <div class="form-row">
                <label for="node-input-rpi"><i class="fa fa-tag"></i> RPI</label>
                <input type="text" id="node-config-input-rpi" class="st-integer-entry" style="width: 50px;">
            </div>
        
            <div class="form-row">
                <label for="node-input-aconfig"><i class="fa fa-tag"></i> Config Assembly</label>
                <input type="text" id="node-config-input-assconfig"  style="width: 50px;">
            </div>
            <div class="form-row">
                <label for="node-input-sizeconfig"><i class="fa fa-tag"></i> Config Size</label>
                <input type="text" id="node-config-input-sizeconfig"  style="width: 50px;">
            </div>
        
            <div class="form-row">
                <label for="node-input-assinput"><i class="fa fa-tag"></i> Input Assembly</label>
                <input type="text" id="node-config-input-assinput"  style="width: 50px;">
            </div>

            <div class="form-row">
                <label for="node-input-sizeinput"><i class="fa fa-tag"></i> Input Size</label>
                <input type="text" id="node-config-input-sizeinput"  style="width: 50px;">
            </div>
            
            <div class="form-row">
                <label for="node-input-assoutput"><i class="fa fa-tag"></i> Output Assembly</label>
                <input type="text" id="node-config-input-assoutput"  style="width: 50px;">
            </div>

            <div class="form-row">
                <label for="node-input-sizeoutput"><i class="fa fa-tag"></i> Output Size</label>
                <input type="text" id="node-config-input-sizeoutput"  style="width: 50px;">
            </div>
        
        </div>

        <div id="conn-tab-config" style="display:none">
            <div class="form-row node-input-configdata-row hide" style="margin-bottom: 0px;">
                <label><i class="fa fa-cubes"></i> Config Data</label>
            </div>
            <div class="form-row node-input-configdata-row hide" id="node-config-input-configdata-row">
                <ol id="node-config-input-configdata-container"></ol>
            </div>
        </div>

        <div id="conn-tab-eds" style="display:none">
        </div>

    </div>
</script>

<script type="text/javascript">
    
    function setupTabs() {
        let tabs = RED.tabs.create({
                id: "conn-tabs",
                onchange: function(tab) {
                    $("#conn-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });

            tabs.addTab({
                id: "conn-tab-setup",
                iconClass: "fa fa-cog",
                label: "Setup"
            });

            tabs.addTab({
                id: "conn-tab-config",
                label: "Config"
            });

            tabs.addTab({
                id: "conn-tab-eds",
                label: "EDS"
            });
    }

    RED.nodes.registerType('eip-io connection',{
        category: 'config',
        defaults: {
            name: {value:""},
            scanner: {value: "", type: "eip-io scanner"},
            ipaddress: {value: "0.0.0.0"},
            rpi: {value: 50},
            assconfig: {value: 0},
            sizeconfig: {value: 0},
            assinput: {value: 0},
            sizeinput: {value: 0},
            assoutput: {value: 0},
            sizeoutput: {value: 0}      
        },
        oneditprepare: function() {
            let that = this;
            setupTabs();

            $(".node-input-configdata-row").show();
            let configDataList = $('#node-config-input-configdata-container').css('min-height','100px').css('min-width','450px').editableList({
                header: $('<div><div>Size</div><div>Value</div><div>Description</div>'),
                addItem: function(container, i, opt) {
                    let row0 = $("<div/>").addClass("node-configdata-entry").appendTo(container)
                    let configSizeSpan = $('<span>').appendTo(row0)
                    let configSize = $("<input/>", {
                        class: "node-input-config-datasize-val",
                        type: "text"
                    }).css({
                    }).appendTo(configSizeSpan)

                }
            });
        }
    });
</script>